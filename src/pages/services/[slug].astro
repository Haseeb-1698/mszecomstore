---
export async function getStaticPaths() {
  const services = await getServices();
  return services.map(service => ({
    params: { slug: service.slug || service.name.toLowerCase().replace(/ /g, '-') },
  }));
}

import Layout from '../../layouts/Layout.astro';
import { getServices, getServiceBySlug } from '../../lib/api/services';
import ServiceDetail from '../../components/service/ServiceDetail';

const { slug } = Astro.params;
const service = await getServiceBySlug(slug as string);

// Since getStaticPaths only generates paths for existing services, service should always exist
// But we'll handle the case gracefully
if (!service) {
  return Astro.redirect('/404');
}

// Transform plans for the component
const plans = (service.plans || []).map(plan => ({
  id: plan.id,
  name: plan.name,
  tier: plan.type,
  duration_months: plan.duration_months,
  price: plan.price,
  original_price: plan.original_price ?? undefined,
  savings: plan.savings ?? undefined,
  features: Array.isArray(plan.features) ? plan.features.filter((f): f is string => typeof f === 'string') : [],
  is_popular: plan.is_popular,
  is_available: plan.is_available,
}));
---

<Layout title={`${service.name} - MSZ Ecom Store`}>
  <ServiceDetail
    client:load
    serviceId={service.id}
    serviceName={service.name}
    serviceDescription={service.description || ''}
    serviceLongDescription={service.long_description ?? undefined}
    serviceIcon={service.icon_url ?? undefined}
    plans={plans}
  />
</Layout>
