---
import Layout from '../../layouts/Layout.astro';
import { getServiceBySlug } from '../../lib/api/services';
import ServiceDetail from '../../components/service/ServiceDetail';

export const prerender = false;

const { slug } = Astro.params;

if (!slug) {
  return Astro.redirect('/404');
}

const service = await getServiceBySlug(slug);

if (!service) {
  return Astro.redirect('/404');
}

// Transform plans for the component
const plans = (service.plans || []).map(plan => ({
  id: plan.id,
  name: plan.name,
  duration_months: plan.duration_months,
  price: plan.price,
  features: Array.isArray(plan.features) ? plan.features.filter((f): f is string => typeof f === 'string') : [],
  is_popular: plan.is_popular,
  is_available: plan.is_available,
}));
---

<Layout title={`${service.name} - MSZ Ecom Store`}>
  <ServiceDetail
    client:load
    serviceId={service.id}
    serviceName={service.name}
    serviceDescription={service.description || ''}
    serviceLongDescription={service.long_description ?? undefined}
    serviceIcon={service.icon_url ?? undefined}
    plans={plans}
  />
</Layout>
